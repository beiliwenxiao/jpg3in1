syntax = "proto3";

package framework.jsonrpc;

option java_package = "com.framework.proto";
option java_outer_classname = "JsonRpcProto";
option go_package = "github.com/framework/golang-sdk/proto";

// JSON-RPC 2.0 请求
// 参考: https://www.jsonrpc.org/specification
message JsonRpcRequest {
  // JSON-RPC 版本，必须是 "2.0"
  string jsonrpc = 1;
  
  // 方法名称
  string method = 2;
  
  // 参数（可以是数组或对象，使用 JSON 编码）
  bytes params = 3;
  
  // 请求 ID（可选，如果不存在则为通知）
  oneof id_value {
    string id_string = 4;
    int64 id_number = 5;
  }
  
  // 扩展字段：追踪信息
  string trace_id = 6;
  string span_id = 7;
}

// JSON-RPC 2.0 响应
message JsonRpcResponse {
  // JSON-RPC 版本，必须是 "2.0"
  string jsonrpc = 1;
  
  // 结果（成功时存在）
  bytes result = 2;
  
  // 错误（失败时存在）
  JsonRpcError error = 3;
  
  // 请求 ID（必须与请求的 ID 匹配）
  oneof id_value {
    string id_string = 4;
    int64 id_number = 5;
  }
  
  // 扩展字段：追踪信息
  string trace_id = 6;
  string span_id = 7;
}

// JSON-RPC 2.0 错误对象
message JsonRpcError {
  // 错误码
  int32 code = 1;
  
  // 错误消息
  string message = 2;
  
  // 额外的错误数据（可选）
  bytes data = 3;
}

// JSON-RPC 2.0 批量请求
message JsonRpcBatchRequest {
  repeated JsonRpcRequest requests = 1;
}

// JSON-RPC 2.0 批量响应
message JsonRpcBatchResponse {
  repeated JsonRpcResponse responses = 1;
}

// JSON-RPC 2.0 标准错误码
enum JsonRpcErrorCode {
  JSON_RPC_ERROR_CODE_UNSPECIFIED = 0;
  
  // 标准错误码
  PARSE_ERROR = -32700;          // 解析错误
  INVALID_REQUEST = -32600;      // 无效请求
  METHOD_NOT_FOUND = -32601;     // 方法不存在
  INVALID_PARAMS = -32602;       // 无效参数
  INTERNAL_ERROR = -32603;       // 内部错误
  
  // 服务器错误（-32000 到 -32099 保留）
  SERVER_ERROR_START = -32099;
  SERVER_ERROR_END = -32000;
}

// JSON-RPC 通知（没有 ID 的请求）
message JsonRpcNotification {
  string jsonrpc = 1;
  string method = 2;
  bytes params = 3;
  string trace_id = 4;
  string span_id = 5;
}
